---
title: "Journal (reproducible report)"
author: "Tobias Tiedemann"
date: "2020-11-21"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: true
    toc_depth: 3
    #code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```


#Chapter 2 -- first Challange

Last compiled: `r Sys.Date()`

The sales data of a company in the bicycle sales sector were analyzed for the period from 2015 to 2019 and the results were presented in diagrams.
The sales in different categories were considered, as well as the sales that were made across the Federal Republic of Germany. These sales were shown across states and cities.

```{r plot,fig.width=10, fig.height=7}

# 1.0 Load libraries ----
library(tidyverse)
library(readxl)
library(lubridate)
library(writexl)

# 2.0 Importing Files ----
bikes_tbl      <- read_excel(path = "DS_101/00_data/01_bike_sales/01_raw_data/bikes.xlsx")
orderlines_tbl <- read_excel("DS_101/00_data/01_bike_sales/01_raw_data/orderlines.xlsx")
bikeshops_tbl  <- read_excel("DS_101/00_data/01_bike_sales/01_raw_data/bikeshops.xlsx")
# 3.0 Examining Data ----


# 4.0 Joining Data ----
bike_orderlines_joined_tbl <- orderlines_tbl %>%
  left_join(bikes_tbl, by = c("product.id" = "bike.id")) %>%
  left_join(bikeshops_tbl, by = c("customer.id" = "bikeshop.id"))

#6.3 Sales by State
sales_by_state_tbl <- bike_orderlines_wrangled_tbl %>%
  select(order_date, total_price, state) %>%
  mutate(year = year(order_date)) %>%
  group_by(year, state) %>%
  summarise(sales = sum(total_price)) %>%
  ungroup() %>%
  mutate(sales_text = scales::dollar(sales, big.mark = ".", 
                                     decimal.mark = ",", 
                                     prefix = "", 
                                     suffix = " €"))

sales_by_state_tbl %>%
  ggplot(aes(x = year, y = sales, fill = state)) +
  geom_col() +
  facet_wrap(~ state) +
  scale_y_continuous(labels = scales::dollar_format(big.mark = ".", 
                                                    decimal.mark = ",", 
                                                    prefix = "", 
                                                    suffix = " €")) +
  labs(
    title = "Revenue by year and States",
    subtitle = "",
    fill = "" # Changes the legend name
    + theme(axis.text.x = element_text(angle = 45, hjust = 1))
    )
#6.4 Sales by City
sales_by_city_tbl <- bike_orderlines_wrangled_tbl %>%
  select(order_date, total_price, city) %>%
  mutate(year = year(order_date)) %>%
  group_by(year, city) %>%
  summarise(sales = sum(total_price)) %>%
  ungroup() %>%
  mutate(sales_text = scales::dollar(sales, big.mark = ".", 
                                     decimal.mark = ",", 
                                     prefix = "", 
                                     suffix = " €"))

sales_by_city_tbl %>%
  ggplot(aes(x = year, y = sales, fill = city)) +
  geom_col() +
  facet_wrap(~ city) +
  scale_y_continuous(labels = scales::dollar_format(big.mark = ".", 
                                                    decimal.mark = ",", 
                                                    prefix = "", 
                                                    suffix = " €")) +
  labs(
    title = "Revenue by year and Cities",
    subtitle = "",
    fill = "" # Changes the legend name
    + theme(axis.text.x = element_text(angle = 45, hjust = 1))
    )
```
#Chapter 3
Data Aquisition via an API
I used the Quandl Data Provider to get access to their API. The Data is the Electricity generation in Germany from 1985 until today
```{Chapter 2}
library(httr)
library(jsonlite)
library(tidyverse)

resp <- GET("https://www.quandl.com/api/v3/datasets/BP/ELEC_GEN_DEU.json?api_key=3fzuzvof5E_4V2rs-WWm")

resp %>% 
  .$content %>% 
  rawToChar() %>% 
  fromJSON()
  
```
dataset data
      [,1]         [,2]          
 [1,] "2018-12-31" "648.7"       
 [2,] "2017-12-31" "653.6547"    
 [3,] "2016-12-31" "650.70734396"
 [4,] "2015-12-31" "648.14928057"
 [5,] "2014-12-31" "627.76510177"
 [6,] "2013-12-31" "638.73"      
 [7,] "2012-12-31" "630.149"     
 [8,] "2011-12-31" "613.070326"  
 [9,] "2010-12-31" "633.093"     
[10,] "2009-12-31" "595.624"     
[11,] "2008-12-31" "640.686"     
[12,] "2007-12-31" "640.578"     
[13,] "2006-12-31" "639.5665"    
[14,] "2005-12-31" "622.575"     
[15,] "2004-12-31" "617.4652"    
[16,] "2003-12-31" "608.78"      
[17,] "2002-12-31" "586.688"     
[18,] "2001-12-31" "586.4115"    
[19,] "2000-12-31" "576.556"     
[20,] "1999-12-31" "556.301"     
[21,] "1998-12-31" "557.217"     
[22,] "1997-12-31" "552.324"     
[23,] "1996-12-31" "552.669"     
[24,] "1995-12-31" "536.821"     
[25,] "1994-12-31" "528.4692"    
[26,] "1993-12-31" "527.118"     
[27,] "1992-12-31" "538.1657"    
[28,] "1991-12-31" "540.222"     
[29,] "1990-12-31" "549.9"       
[30,] "1989-12-31" "559.873"     
[31,] "1988-12-31" "549.492"     
[32,] "1987-12-31" "532.442"     
[33,] "1986-12-31" "523.557"     
[34,] "1985-12-31" "522.534"  